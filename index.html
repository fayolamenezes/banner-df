<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WebGL Banner Scroll Unroll</title>
<script src="https://cdn.jsdelivr.net/npm/three@0.156.1/build/three.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.13.0/gsap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.13.0/ScrollTrigger.min.js"></script>
<style>
  body { margin:0; background:#000; overflow-x:hidden; }
  canvas { display:block; }
</style>
</head>
<body>

<script>
let scene, camera, renderer, clock;
let rod, banner;

init();
animate();

function init() {
    scene = new THREE.Scene();
    scene.background = new THREE.Color(0x000000);
    camera = new THREE.PerspectiveCamera(45, window.innerWidth/window.innerHeight, 0.1, 1000);
    camera.position.set(0, 3, 8);

    renderer = new THREE.WebGLRenderer({antialias:true});
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.localClippingEnabled = true;
    document.body.appendChild(renderer.domElement);

    // --- Rod ---
    const rodGeo = new THREE.BoxGeometry(window.innerWidth / window.innerHeight * 8, 0.05, 0.05);
    const rodMat = new THREE.MeshBasicMaterial({color: 0xffffff});
    rod = new THREE.Mesh(rodGeo, rodMat);
    rod.position.set(0, 4, 0);
    rod.scale.x = 0; 
    scene.add(rod);

    // --- Banner ---
    const bannerHeight = 4;
    const bannerWidth  = 10;
    const bannerGeo = new THREE.PlaneGeometry(bannerWidth, bannerHeight, 100, 50); // finer mesh

    const clipPlane = new THREE.Plane(new THREE.Vector3(0, -1, 0), 4);

    // âœ… Pure white, ignores lights, no shading
    const bannerMat = new THREE.MeshBasicMaterial({
        color: 0xffffff,
        side: THREE.DoubleSide,
        clippingPlanes: [clipPlane],
        toneMapped: false
    });

    banner = new THREE.Mesh(bannerGeo, bannerMat);
    banner.position.set(0, 4 + bannerHeight, 0);
    scene.add(banner);

    clock = new THREE.Clock();

    window.addEventListener('resize', () => {
        camera.aspect = window.innerWidth/window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
        rod.geometry.dispose();
        rod.geometry = new THREE.BoxGeometry(window.innerWidth / window.innerHeight * 8, 0.05, 0.05);
    });

    document.body.style.height = `${window.innerHeight + bannerHeight*200}px`;

    gsap.registerPlugin(ScrollTrigger);

    const tl = gsap.timeline({
        scrollTrigger: {
            trigger: document.body,
            start: "top top",
            end: "+=" + bannerHeight*200,
            scrub: true,
            pin: true
        }
    });

    tl.to(rod.scale, { x: 1, ease: "power2.out" }, 0)
      .fromTo(banner.position, 
        { y: 4 + bannerHeight }, 
        { y: 4 - bannerHeight/2, ease: "power2.out" }, 
        0.5
      );
}

// --- Banner flutter (wind pushes from center, stronger + faster) ---
function updateBanner() {
    const time = clock.getElapsedTime();
    const geo = banner.geometry;
    const pos = geo.attributes.position;

    const h = geo.parameters.height;
    const w = geo.parameters.width;

    // Stronger + faster gust
    const gust = Math.sin(time * 1.5) * 0.3;  // was 1.5 * 0.35

    for (let i = 0; i < pos.count; i++) {
        const x = pos.getX(i);
        const y = pos.getY(i);

        // keep top pinned to rod
        if (y >= h/2 - 0.01) {
            pos.setZ(i, 0);
            continue;
        }

        // normalized distance from center
        const distX = x / (w/2);
        const distY = y / (h/2);
        const dist = Math.sqrt(distX * distX + distY * distY);

        // central bulge: stronger push
        const bulge = gust * (1 - dist);

        // amplified natural ripples
        const wave =
            Math.sin(x * 1.8 + time * 2.5) * 0.12 +
            Math.sin(y * 1.0 + time * 2.0) * 0.1 +
            Math.sin((x * 0.6 + y * 0.4) + time * 3.5) * 0.07;

        pos.setZ(i, bulge + wave);
    }

    pos.needsUpdate = true;
}

// --- Animation loop ---
function animate() {
    requestAnimationFrame(animate);
    updateBanner();
    renderer.render(scene, camera);
}
</script>

</body>
</html>
